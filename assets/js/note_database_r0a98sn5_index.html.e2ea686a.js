"use strict";(self.webpackChunkunravely_blog=self.webpackChunkunravely_blog||[]).push([[4402],{3449:(s,i,a)=>{a.r(i),a.d(i,{comp:()=>l,data:()=>e});var n=a(6254);const t={},l=(0,a(1021).A)(t,[["render",function(s,i){return(0,n.uX)(),(0,n.CE)("div",null,i[0]||(i[0]=[(0,n.Fv)('<p>PostgreSQL数据库有多种方法可实现自增字段的设置，常用的有：</p><ol><li>SERIAL，最简单</li><li>IDENTITY，是PostgreSQL 10的新增特性</li><li>创建SEQUENCE，更灵活</li></ol><h2 id="_1-serial" tabindex="-1"><a class="header-anchor" href="#_1-serial"><span>1. SERIAL</span></a></h2><p>SMALLSERIAL、SERIAL 和 BIGSERIAL 范围：</p><table><thead><tr><th style="text-align:left;">伪类型</th><th style="text-align:left;">存储大小</th><th style="text-align:left;">范围</th></tr></thead><tbody><tr><td style="text-align:left;"><code>SMALLSERIAL</code></td><td style="text-align:left;">2字节</td><td style="text-align:left;">1 到 32,767</td></tr><tr><td style="text-align:left;"><code>SERIAL</code></td><td style="text-align:left;">4字节</td><td style="text-align:left;">1 到 2,147,483,647</td></tr><tr><td style="text-align:left;"><code>BIGSERIAL</code></td><td style="text-align:left;">8字节</td><td style="text-align:left;">1 到 922,337,2036,854,775,807</td></tr></tbody></table><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">create</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> table</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> dictionary</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   id                   </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">SERIAL</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> not null</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   parent_id            INT4                 </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">not null</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>\n<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">   type</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">                 VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">50</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)          </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">not null</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   item_name            </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">100</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)         </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">not null</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   item_value           </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">100</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)         </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">null</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   comment              </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">200</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)         </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">null</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   deleted              INT2                 </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">not null</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> default</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">   create_time          </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">DATE</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">                 not null</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> default</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> CURRENT_TIMESTAMP,</span></span>\n<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">   constraint</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> PK_dictionary </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">primary key</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (id)</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-identity-推荐" tabindex="-1"><a class="header-anchor" href="#_2-identity-推荐"><span>2. IDENTITY （推荐）</span></a></h2><p>（PostgreSQL 10 及以上版本）</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CREATE</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> TABLE</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> t_user</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    user_id </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">integer</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> GENERATED</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> ALWAYS</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> AS</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> IDENTITY</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> PRIMARY KEY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ,</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    user_name </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">varchar</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">50</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">NOT NULL</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> UNIQUE</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">INSERT INTO</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> t_user (user_name) </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">value</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">tony</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-sequence-不推荐" tabindex="-1"><a class="header-anchor" href="#_3-sequence-不推荐"><span>3. SEQUENCE （不推荐）</span></a></h2><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">-- 创建序列</span></span>\n<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">CREATE</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> SEQUENCE</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> users_id_seq</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">    //</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">设置序列名</span></span>\n<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">START</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> WITH</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">\t\t\t\t\t//</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">初始值</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">INCREMENT </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">BY</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 1</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">                  //</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">增长值</span></span>\n<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">NO</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> MINVALUE\t\t\t\t\t\t</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">//</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">最小值\t\t\t\t\t\t</span></span>\n<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">NO</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> MAXVALUE                     </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">//</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">最大值 </span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">CACHE </span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">;\t\t\t\t\t\t</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">//</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">缓存</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">INCREMENT </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ： 每次序列增加（或减少）的步长</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">MINVALUE ： 序列最小值，</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">NO</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> MINVALUE表示没有最小值</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">MAXVALUE ： 序列最大值，</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">NO</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> MAXVALUE表示没有最大值</span></span>\n<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">START</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> WITH</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ：以什么序列值开始</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">CYCLE ： 序列是否循环使用</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">OWNED </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">BY</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ： 可以直接指定一个表的字段，也可以不指定。</span></span>\n<span class="line"></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">alter</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> table</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> users </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">alter</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> column id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">set</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> default</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> nextval(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">users_id_seq</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">create</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> table</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> dictionary</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  id int4 </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">NOT NULL</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> DEFAULT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> nextval(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">users_id_seq</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">),</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  parent_id            INT4                 </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">not null</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>\n<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">  type</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">                 VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">50</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)          </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">not null</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  item_name            </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">100</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)         </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">not null</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  item_value           </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">100</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)         </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">null</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  comment              </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">VARCHAR</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">(</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">200</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)         </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">null</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  deleted              INT2                 </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">not null</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> default</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 0</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">,</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">  create_time          </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">DATE</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">                 not null</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> default</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> CURRENT_TIMESTAMP,</span></span>\n<span class="line"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">   constraint</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> PK_dictionary </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">primary key</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> (id)</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有时，在使用第二种方式时，可能会见到这种语句：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ALTER</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> TABLE</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ONLY table_name </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">ALTER</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> COLUMN id </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">SET</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> DEFAULT</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> nextval(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">table_name_id_seq</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">::regclass);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>这里，::是postgresql的类型转换操作符，是将SEQUENCE类型的&#39;table_name_id_seq&#39;转换成regclass类型，regclass类型是postgresql系统表用到的一个隐藏字段，值唯一，可以作为隐藏主键。用户表不建议使用。::regclass可以省略。</p><p>使用如下sql可以获取序列当前值：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><button class="copy" title="复制代码" data-copied="已复制"></button><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">select</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> currval(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">test_id_seq</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><table><thead><tr><th>函数</th><th>返回类型</th><th>描述</th><th></th></tr></thead><tbody><tr><td>nextval(regclass)</td><td>bigint</td><td>递增序列对象到它的下一个数值并且返回该值。这个动作是自动完成的。即使多个会话并发运行nextval，每个进程也会安全地收到一个唯一的序列值。</td><td>获取指定序列最近一次使用netxval后的数值，如果没有使用nextval而直接使用currval会出错</td></tr><tr><td>currval(regclass)</td><td>bigint</td><td>在当前会话中返回最近一次nextval抓到的该序列的数值。(如果在本会话中从未在该序列上调用过 nextval，那么会报告一个错误。)请注意因为此函数返回一个会话范围的数值，而且也能给出一个可预计的结果，因此可以用于判断其它会话是否执行过nextval。</td><td>返回最近一次用 nextval 获取的任意序列的数值</td></tr><tr><td>lastval()</td><td>bigint</td><td>返回当前会话里最近一次nextval返回的数值。这个函数等效于currval，只是它不用序列名为参数，它抓取当前会话里面最近一次nextval使用的序列。如果当前会话还没有调用过nextval，那么调用lastval将会报错。</td><td>递增序列并返回新值</td></tr><tr><td>setval(regclass, bigint)</td><td>bigint</td><td>重置序列对象的计数器数值。设置序列的last_value字段为指定数值并且将其is_called字段设置为true，表示下一次nextval将在返回数值之前递增该序列。</td><td>设置序列的当前数值</td></tr><tr><td>setval(regclass, bigint, boolean)</td><td>bigint</td><td>重置序列对象的计数器数值。功能等同于上面的setval函数，只是is_called可以设置为true或false。如果将其设置为false，那么下一次nextval将返回该数值，随后的nextval才开始递增该序列。</td><td>设置序列的当前数值以及 is_called 标志，如果为true则立即生效，如果为false，则调用一次nextval后才会生效</td></tr></tbody></table>',17)]))}]]),e=JSON.parse('{"path":"/note_database/r0a98sn5/","title":"创建递增主键","lang":"zh-CN","frontmatter":{"title":"创建递增主键","createTime":"2024/11/17 01:18:53","permalink":"/note_database/r0a98sn5/","description":"PostgreSQL数据库有多种方法可实现自增字段的设置，常用的有： SERIAL，最简单 IDENTITY，是PostgreSQL 10的新增特性 创建SEQUENCE，更灵活 1. SERIAL SMALLSERIAL、SERIAL 和 BIGSERIAL 范围： 2. IDENTITY （推荐） （PostgreSQL 10 及以上版本） 3. ...","head":[["meta",{"property":"og:url","content":"https://www.unravely.press/note_database/r0a98sn5/"}],["meta",{"property":"og:site_name","content":"Unravely"}],["meta",{"property":"og:title","content":"创建递增主键"}],["meta",{"property":"og:description","content":"PostgreSQL数据库有多种方法可实现自增字段的设置，常用的有： SERIAL，最简单 IDENTITY，是PostgreSQL 10的新增特性 创建SEQUENCE，更灵活 1. SERIAL SMALLSERIAL、SERIAL 和 BIGSERIAL 范围： 2. IDENTITY （推荐） （PostgreSQL 10 及以上版本） 3. ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-12-25T09:48:04.000Z"}],["meta",{"property":"article:modified_time","content":"2024-12-25T09:48:04.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"创建递增主键\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-12-25T09:48:04.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"1. SERIAL","slug":"_1-serial","link":"#_1-serial","children":[]},{"level":2,"title":"2. IDENTITY （推荐）","slug":"_2-identity-推荐","link":"#_2-identity-推荐","children":[]},{"level":2,"title":"3. SEQUENCE （不推荐）","slug":"_3-sequence-不推荐","link":"#_3-sequence-不推荐","children":[]}],"readingTime":{"minutes":3.29,"words":987},"git":{"createdTime":1731778103000,"updatedTime":1735120084000,"contributors":[{"name":"banxia","email":"yutong9717@163.com","commits":1}]},"autoDesc":true,"filePathRelative":"notes/note_database/1.PostgreSQL/创建递增主键.md","bulletin":false}')}}]);